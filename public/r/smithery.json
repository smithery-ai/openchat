{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "smithery",
  "title": "Smithery",
  "description": "Complete Smithery integration for MCP server management - includes connections, server search, token management, and tool search.",
  "dependencies": [
    "@smithery/api",
    "@tanstack/react-query",
    "jotai",
    "lucide-react"
  ],
  "registryDependencies": [
    "avatar",
    "button",
    "card",
    "combobox",
    "dialog",
    "empty",
    "input",
    "item",
    "select",
    "separator",
    "spinner"
  ],
  "files": [
    {
      "path": "registry/new-york/smithery/connections.tsx",
      "content": "\"use client\";\n\nimport Smithery, { AuthenticationError } from \"@smithery/api\";\nimport type { Connection } from \"@smithery/api/resources/beta/connect/connections.mjs\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { Link as LinkIcon, RefreshCw, Trash2 } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\n\nasync function getDefaultNamespace(client: Smithery) {\n\tconst namespaces = await client.namespaces.list();\n\tif (namespaces.namespaces.length === 0) {\n\t\tthrow new Error(\"No namespaces found\");\n\t}\n\treturn namespaces.namespaces[0].name;\n}\n\nconst getSmitheryClient = (token: string) => {\n\treturn new Smithery({\n\t\tapiKey: token,\n\t\tbaseURL: process.env.NEXT_PUBLIC_SMITHERY_API_URL,\n\t})\n};\n\ntype ConnectionStatus =\n\t| { status: \"connected\"; connection: Connection }\n\t| { status: \"auth_required\"; authorizationUrl?: string }\n\t| { status: \"error\"; error: unknown };\n\nasync function checkConnectionStatus(\n\tclient: Smithery,\n\tconnectionId: string,\n\tnamespace: string,\n): Promise<ConnectionStatus> {\n\ttry {\n\t\tconst jsonRpcResponse = await client.beta.connect.rpc.call(connectionId, {\n\t\t\tnamespace,\n\t\t\tjsonrpc: \"2.0\",\n\t\t\tmethod: \"tools/list\",\n\t\t});\n\t\tconsole.log(\"jsonRpcResponse\", jsonRpcResponse);\n\n\t\tconst connection = await client.beta.connect.connections.get(connectionId, {\n\t\t\tnamespace: namespace,\n\t\t});\n\n\t\treturn {\n\t\t\tstatus: \"connected\",\n\t\t\tconnection,\n\t\t};\n\t} catch (error) {\n\t\tif (error instanceof AuthenticationError) {\n\t\t\tconst errorData = error.error as unknown as {\n\t\t\t\terror?: { data?: { authorizationUrl?: string } };\n\t\t\t\tdata?: { authorizationUrl?: string };\n\t\t\t};\n\t\t\tconst authorizationUrl =\n\t\t\t\terrorData?.error?.data?.authorizationUrl ||\n\t\t\t\terrorData?.data?.authorizationUrl;\n\t\t\treturn {\n\t\t\t\tstatus: \"auth_required\",\n\t\t\t\tauthorizationUrl,\n\t\t\t};\n\t\t}\n\t\tconsole.error(\"error connecting to server\", error);\n\t\treturn {\n\t\t\tstatus: \"error\",\n\t\t\terror,\n\t\t};\n\t}\n}\n\nexport const ConnectionCard = ({\n\tconnection,\n\ttoken,\n\tnamespace,\n}: {\n\tconnection: Connection;\n\ttoken: string;\n\tnamespace: string;\n}) => {\n\tconst queryClient = useQueryClient();\n\tconst [testConnectionData, setTestConnectionData] = useState<ConnectionStatus | null>(null);\n\n\tconst deleteMutation = useMutation({\n\t\tmutationFn: async () => {\n\t\t\tconst client = getSmitheryClient(token);\n\t\t\tawait client.beta.connect.connections.delete(connection.connectionId, {\n\t\t\t\tnamespace: namespace,\n\t\t\t});\n\t\t},\n\t\tonSuccess: () => {\n\t\t\tqueryClient.invalidateQueries({ queryKey: [\"connections\"] });\n\t\t},\n\t});\n\n\tconst testMutation = useMutation({\n\t\tmutationFn: async () => {\n\t\t\tconst client = getSmitheryClient(token);\n\t\t\treturn await checkConnectionStatus(\n\t\t\t\tclient,\n\t\t\t\tconnection.connectionId,\n\t\t\t\tnamespace,\n\t\t\t);\n\t\t},\n\t\tonSuccess: (data) => {\n\t\t\tsetTestConnectionData(data);\n\t\t},\n\t\tonError: (error) => {\n\t\t\tconsole.error(\"error testing connection\", error);\n\t\t\tsetTestConnectionData({\n\t\t\t\tstatus: \"error\",\n\t\t\t\terror,\n\t\t\t});\n\t\t},\n\t});\n\n\treturn (\n\t\t<Card className=\"border-none shadow-none\">\n\t\t\t<CardContent className=\"flex items-center gap-4\">\n\t\t\t\t<Avatar className=\"h-10 w-10 rounded-md\">\n\t\t\t\t\t<AvatarImage src={connection.iconUrl || \"\"} />\n\t\t\t\t\t<AvatarFallback className=\"rounded-md bg-muted\">\n\t\t\t\t\t\t{connection.name.charAt(0)}\n\t\t\t\t\t</AvatarFallback>\n\t\t\t\t</Avatar>\n\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t<h3 className=\"font-medium truncate\">{connection.name}</h3>\n\t\t\t\t\t<p className=\"text-muted-foreground text-xs truncate\">\n\t\t\t\t\t\t{connection.connectionId}\n\t\t\t\t\t</p>\n\t\t\t\t\t<p className=\"text-muted-foreground text-xs truncate\">\n\t\t\t\t\t\t{connection.mcpUrl}\n\t\t\t\t\t</p>\n\t\t\t\t\t<p className=\"text-muted-foreground text-xs truncate\">\n\t\t\t\t\t\t{new Date(connection.createdAt || \"\").toLocaleDateString()}{\" \"}\n\t\t\t\t\t\t{new Date(connection.createdAt || \"\").toLocaleTimeString()}\n\t\t\t\t\t</p>\n\t\t\t\t\t<p className=\"text-muted-foreground text-xs truncate\">\n\t\t\t\t\t\t{connection.metadata && JSON.stringify(connection.metadata)}\n\t\t\t\t\t</p>\n\t\t\t\t\t{testConnectionData?.status === \"connected\" && (\n\t\t\t\t\t\t<p className=\"text-green-600 text-xs\">Connected</p>\n\t\t\t\t\t)}\n\t\t\t\t\t{testConnectionData?.status === \"auth_required\" &&\n\t\t\t\t\t\ttestConnectionData?.authorizationUrl && (\n\t\t\t\t\t\t\t<div className=\"mt-2\">\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\twindow.open(\n\t\t\t\t\t\t\t\t\t\t\ttestConnectionData.authorizationUrl,\n\t\t\t\t\t\t\t\t\t\t\t\"_blank\",\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tAuthorize\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t{testConnectionData?.status === \"error\" && (\n\t\t\t\t\t\t<p className=\"text-destructive text-xs\">\n\t\t\t\t\t\t\tError:{\" \"}\n\t\t\t\t\t\t\t{testConnectionData.error instanceof Error\n\t\t\t\t\t\t\t\t? testConnectionData.error.message\n\t\t\t\t\t\t\t\t: \"Unknown error\"}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\tonClick={() => testMutation.mutate()}\n\t\t\t\t\tdisabled={testMutation.isPending}\n\t\t\t\t\ttitle=\"Test connection\"\n\t\t\t\t>\n\t\t\t\t\t<LinkIcon className=\"h-4 w-4\" />\n\t\t\t\t</Button>\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\tonClick={() => deleteMutation.mutate()}\n\t\t\t\t\tdisabled={deleteMutation.isPending}\n\t\t\t\t>\n\t\t\t\t\t<Trash2 className=\"h-4 w-4\" />\n\t\t\t\t</Button>\n\t\t\t</CardContent>\n\t\t</Card>\n\t);\n};\n\nexport const Connections = ({ token, namespace }: { token: string, namespace?: string }) => {\n\tconst { data, isLoading, error, refetch, isFetching } = useQuery({\n\t\tqueryKey: [\"connections\", token],\n\t\tqueryFn: async () => {\n\t\t\tif (!token) {\n\t\t\t\tthrow new Error(\"API token is required\");\n\t\t\t}\n\t\t\tconst client = getSmitheryClient(token);\n\t\t\tconst namespaceToUse = namespace || await getDefaultNamespace(client);\n\t\t\tconst connections = await client.beta.connect.connections.list(namespaceToUse);\n\t\t\treturn { connections, namespace: namespaceToUse };\n\t\t},\n\t\tenabled: !!token,\n\t});\n\n\treturn (\n\t\t<div className=\"max-w-md mx-auto\">\n\t\t\t<div className=\"flex items-center justify-between mb-4\">\n\t\t\t\t<h2 className=\"text-lg font-semibold\">Connections</h2>\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\tonClick={() => refetch()}\n\t\t\t\t\tdisabled={isFetching}\n\t\t\t\t\ttitle=\"Refresh connections\"\n\t\t\t\t>\n\t\t\t\t\t<RefreshCw className={`h-4 w-4 ${isFetching ? \"animate-spin\" : \"\"}`} />\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t\t{isLoading && <p className=\"text-muted-foreground\">Loading...</p>}\n\t\t\t{error && <p className=\"text-destructive\">Error: {error.message}</p>}\n\t\t\t{data && (\n\t\t\t\t<div className=\"space-y-2 overflow-auto max-h-[500px]\">\n\t\t\t\t\t{data.connections.connections.length === 0 && <p className=\"text-muted-foreground\">No connections found</p>}\n\t\t\t\t\t{data.connections.connections.map((connection: Connection) => (\n\t\t\t\t\t\t<div key={connection.connectionId}>\n\t\t\t\t\t\t\t<ConnectionCard\n\t\t\t\t\t\t\t\tconnection={connection}\n\t\t\t\t\t\t\t\ttoken={token}\n\t\t\t\t\t\t\t\tnamespace={data.namespace}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<Separator />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t))}\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n",
      "type": "registry:component",
      "target": "components/smithery/connections.tsx"
    },
    {
      "path": "registry/new-york/smithery/server-search.tsx",
      "content": "\"use client\";\n\nimport Smithery, { AuthenticationError } from \"@smithery/api\";\nimport type { Connection } from \"@smithery/api/resources/beta/connect/connections.mjs\";\nimport type { ServerListResponse } from \"@smithery/api/resources/servers/servers.mjs\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { useState, useEffect } from \"react\";\nimport { useDebounce } from \"@/hooks/use-debounce\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n\tCombobox,\n\tComboboxContent,\n\tComboboxEmpty,\n\tComboboxInput,\n\tComboboxItem,\n\tComboboxList,\n} from \"@/components/ui/combobox\";\nimport {\n\tItem,\n\tItemContent,\n\tItemDescription,\n\tItemMedia,\n\tItemTitle,\n} from \"@/components/ui/item\";\nimport { ArrowRight, CheckCircle, Link, Loader2, Lock } from \"lucide-react\";\n\ninterface AuthRequiredBannerProps {\n\tserverName: string;\n\tauthorizationUrl?: string;\n\tcountdown: number | null;\n}\n\nconst AuthRequiredBanner = ({ serverName, authorizationUrl, countdown }: AuthRequiredBannerProps) => (\n\t<div className=\"flex items-start gap-3 rounded-md bg-muted p-3\">\n\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t<p className=\"text-sm font-medium text-foreground flex items-center gap-1\">\n\t\t\t\t<Lock className=\"size-3.5 flex-shrink-0 font-bold\" /> <span className=\"font-medium\">Authorization required</span>\n\t\t\t</p>\n\t\t\t<p className=\"text-xs text-muted-foreground mt-1\">\n\t\t\t\tThis server requires you to authorize access. You should be automatically redirected to complete authentication.\n\t\t\t\t{\" \"}{countdown !== null && countdown > 0\n\t\t\t\t\t? `Redirecting in ${countdown}...`\n\t\t\t\t\t: \"If not, click the link below.\"}\n\t\t\t</p>\n\t\t\t{authorizationUrl && (\n\t\t\t\t<a\n\t\t\t\t\thref={authorizationUrl}\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\tclassName=\"text-sm font-bold text-blue-500 hover:text-blue-600 mt-4 flex items-center gap-1\"\n\t\t\t\t>\n\t\t\t\t\t<span className=\"font-bold\">Sign in to {serverName}</span> <ArrowRight className=\"size-4\" />\n\t\t\t\t</a>\n\t\t\t)}\n\t\t</div>\n\t</div>\n);\n\ninterface ConnectionButtonProps {\n\tconnectionStatus?: \"connected\" | \"auth_required\" | \"error\";\n\tisConnecting: boolean;\n\tonConnect: () => void;\n}\n\nconst ConnectionButton = ({ connectionStatus, isConnecting, onConnect }: ConnectionButtonProps) => {\n\tswitch (connectionStatus) {\n\t\tcase \"connected\":\n\t\t\treturn (\n\t\t\t\t<Button variant=\"secondary\" size=\"sm\" className=\"flex-1\" disabled>\n\t\t\t\t\t<CheckCircle className=\"size-4\" />\n\t\t\t\t\tConnected\n\t\t\t\t</Button>\n\t\t\t);\n\t\tcase \"auth_required\":\n\t\t\treturn (\n\t\t\t\t<Button variant=\"secondary\" size=\"sm\" className=\"flex-1\" disabled>\n\t\t\t\t\t<Loader2 className=\"size-4 animate-spin\" />\n\t\t\t\t\tPending authorization...\n\t\t\t\t</Button>\n\t\t\t);\n\t\tdefault:\n\t\t\treturn (\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"default\"\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tclassName=\"flex-1\"\n\t\t\t\t\tonClick={onConnect}\n\t\t\t\t\tdisabled={isConnecting}\n\t\t\t\t>\n\t\t\t\t\t{isConnecting ? (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<Loader2 className=\"size-4 animate-spin\" />\n\t\t\t\t\t\t\tConnecting...\n\t\t\t\t\t\t</>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\tConnect <ArrowRight className=\"size-4\" />\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</Button>\n\t\t\t);\n\t}\n};\n\ninterface ServerDisplayProps {\n\tserver: ServerListResponse;\n\ttoken: string;\n\tnamespace?: string;\n}\n\nconst ServerDisplay = ({ server, token, namespace }: ServerDisplayProps) => {\n\tconst queryClient = useQueryClient();\n\tconst [countdown, setCountdown] = useState<number | null>(null);\n\n\tconst { data: activeNamespace } = useQuery({\n\t\tqueryKey: [\"defaultNamespace\", token],\n\t\tqueryFn: async () => {\n\t\t\tif (namespace) {\n\t\t\t\treturn namespace;\n\t\t\t}\n\t\t\tconst client = getSmitheryClient(token);\n\t\t\treturn await getDefaultNamespace(client);\n\t\t},\n\t\tenabled: !!token,\n\t});\n\n\tconst {\n\t\tmutate: connect,\n\t\tisPending: isConnecting,\n\t\tdata: connectionData,\n\t\tmutateAsync: connectAsync,\n\t} = useMutation({\n\t\tmutationFn: async () => {\n\t\t\tif (!token || !activeNamespace) {\n\t\t\t\tthrow new Error(\"Token and namespace are required\");\n\t\t\t}\n\t\t\tconst client = getSmitheryClient(token);\n\t\t\treturn await connectToServer(client, server, activeNamespace, token);\n\t\t},\n\t\tonSuccess: () => {\n\t\t\tqueryClient.invalidateQueries({ queryKey: [\"connections\"] });\n\t\t},\n\t\tonError: (error) => {\n\t\t\tconsole.error(\"error connecting to server\", `connectionId: ${server.qualifiedName}, namespace: ${activeNamespace}`, error);\n\t\t},\n\t});\n\n\t// Countdown timer for auth_required state\n\tuseEffect(() => {\n\t\tif (connectionData?.status === \"auth_required\" && countdown === null) {\n\t\t\tsetCountdown(3);\n\t\t}\n\t}, [connectionData?.status, countdown]);\n\n\tuseEffect(() => {\n\t\tif (countdown === null || countdown <= 0) return;\n\n\t\tconst timer = setTimeout(() => {\n\t\t\tsetCountdown(countdown - 1);\n\t\t}, 1000);\n\n\t\treturn () => clearTimeout(timer);\n\t}, [countdown]);\n\n\t// Poll connection status when auth_required\n\tuseEffect(() => {\n\t\tif (connectionData?.status !== \"auth_required\" || !token || !activeNamespace) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst pollInterval = setInterval(async () => {\n\t\t\ttry {\n\t\t\t\tconst client = getSmitheryClient(token);\n\t\t\t\tconst connectionId = generateConnectionId(token, server.qualifiedName);\n\t\t\t\tconst status = await checkConnectionStatus(\n\t\t\t\t\tclient,\n\t\t\t\t\tconnectionId,\n\t\t\t\t\tactiveNamespace,\n\t\t\t\t);\n\n\t\t\t\tif (status.status === \"connected\") {\n\t\t\t\t\t// Update mutation data to trigger re-render\n\t\t\t\t\tawait connectAsync();\n\t\t\t\t\tsetCountdown(null);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"error checking connection status\", error);\n\t\t\t}\n\t\t}, 2000); // Check every 2 seconds\n\n\t\treturn () => clearInterval(pollInterval);\n\t}, [connectionData?.status, token, activeNamespace, server.qualifiedName, connectAsync]);\n\n\treturn (\n\t\t<div className=\"mt-4 p-4 border rounded-md flex flex-col gap-4\">\n\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t<Avatar className=\"h-10 w-10 rounded-md\">\n\t\t\t\t\t<AvatarImage src={server.iconUrl || \"\"} />\n\t\t\t\t\t<AvatarFallback className=\"rounded-md bg-muted\">\n\t\t\t\t\t\t{server.displayName?.charAt(0) ||\n\t\t\t\t\t\t\tserver.qualifiedName?.charAt(0) ||\n\t\t\t\t\t\t\t\"S\"}\n\t\t\t\t\t</AvatarFallback>\n\t\t\t\t</Avatar>\n\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t<h3 className=\"font-medium truncate flex items-center\">\n\t\t\t\t\t\t{server.displayName || server.qualifiedName}\n\t\t\t\t\t\t{server.verified && (\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tclassName=\"text-accent-foreground text-xs ml-2\"\n\t\t\t\t\t\t\t\ttitle=\"Verified\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<CheckCircle className=\"size-4\" />\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</h3>\n\t\t\t\t\t<p className=\"text-muted-foreground text-xs truncate\">\n\t\t\t\t\t\t{server.qualifiedName}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div className=\"line-clamp-2 text-muted-foreground text-sm\">\n\t\t\t\t{server.description && <p>{server.description}</p>}\n\t\t\t</div>\n\n\t\t\t{connectionData?.status === \"auth_required\" && (\n\t\t\t\t<AuthRequiredBanner\n\t\t\t\t\tserverName={server.displayName || server.qualifiedName}\n\t\t\t\t\tauthorizationUrl={connectionData.authorizationUrl}\n\t\t\t\t\tcountdown={countdown}\n\t\t\t\t/>\n\t\t\t)}\n\n\t\t\t<div className=\"mt-2 flex justify-between gap-4\">\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\tclassName=\"flex-1\"\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\twindow.open(server.homepage, \"_blank\");\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\tView Details\n\t\t\t\t</Button>\n\t\t\t\t<ConnectionButton\n\t\t\t\t\tconnectionStatus={connectionData?.status}\n\t\t\t\t\tisConnecting={isConnecting}\n\t\t\t\t\tonConnect={connect}\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t{connectionData?.status === \"error\" && (\n\t\t\t\t<p className=\"text-destructive text-sm mt-2\">\n\t\t\t\t\tError connecting to server\n\t\t\t\t</p>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n\nasync function getDefaultNamespace(client: Smithery) {\n\tconst namespaces = await client.namespaces.list();\n\tif (namespaces.namespaces.length === 0) {\n\t\tthrow new Error(\"No namespaces found\");\n\t}\n\treturn namespaces.namespaces[0].name;\n}\n\nconst getSmitheryClient = (token: string) => {\n\treturn new Smithery({\n\t\tapiKey: token,\n\t});\n};\n\nfunction sanitizeConnectionId(str: string): string {\n\treturn str.replace(/[^a-zA-Z0-9_-]/g, \"_\");\n}\n\nfunction generateConnectionId(token: string, identifier: string): string {\n\treturn `${token.slice(-100)}__${sanitizeConnectionId(identifier)}`;\n}\n\ntype ConnectionStatus =\n\t| { status: \"connected\"; connection: Connection }\n\t| { status: \"auth_required\"; authorizationUrl?: string }\n\t| { status: \"error\"; error: unknown };\n\nasync function checkConnectionStatus(\n\tclient: Smithery,\n\tconnectionId: string,\n\tnamespace: string,\n): Promise<ConnectionStatus> {\n\ttry {\n\t\tconst jsonRpcResponse = await client.beta.connect.rpc.call(connectionId, {\n\t\t\tnamespace,\n\t\t\tjsonrpc: \"2.0\",\n\t\t\tmethod: \"tools/list\",\n\t\t});\n\t\tconsole.log(\"jsonRpcResponse\", jsonRpcResponse);\n\n\t\tconst connection = await client.beta.connect.connections.get(connectionId, {\n\t\t\tnamespace: namespace,\n\t\t});\n\n\t\treturn {\n\t\t\tstatus: \"connected\",\n\t\t\tconnection,\n\t\t};\n\t} catch (error) {\n\t\tif (error instanceof AuthenticationError) {\n\t\t\tconst errorData = error.error as unknown as {\n\t\t\t\terror?: { data?: { authorizationUrl?: string } };\n\t\t\t\tdata?: { authorizationUrl?: string };\n\t\t\t};\n\t\t\tconst authorizationUrl =\n\t\t\t\terrorData?.error?.data?.authorizationUrl ||\n\t\t\t\terrorData?.data?.authorizationUrl;\n\t\t\treturn {\n\t\t\t\tstatus: \"auth_required\",\n\t\t\t\tauthorizationUrl,\n\t\t\t};\n\t\t}\n\t\tconsole.error(\"error connecting to server\", `connectionId: ${connectionId}, namespace: ${namespace}`, error);\n\t\treturn {\n\t\t\tstatus: \"error\",\n\t\t\terror,\n\t\t};\n\t}\n}\n\nasync function connectToServer(\n\tclient: Smithery,\n\tserver: ServerListResponse,\n\tnamespace: string,\n\ttoken: string,\n): Promise<ConnectionStatus> {\n\tconst connectionId = generateConnectionId(token, server.qualifiedName);\n\tconst serverUrl =\n\t\tserver.qualifiedName.startsWith(\"http://\") ||\n\t\tserver.qualifiedName.startsWith(\"https://\")\n\t\t\t? server.qualifiedName\n\t\t\t: `https://server.smithery.ai/${server.qualifiedName}/mcp`;\n\n\tconsole.log(\"checking for existing connection\", connectionId);\n\t// Avoid re-creating an existing connection\n\tconst existingConnection = await client.beta.connect.connections\n\t\t.get(connectionId, {\n\t\t\tnamespace: namespace,\n\t\t})\n\t\t.catch(() => {\n\t\t\treturn null;\n\t\t});\n\tconsole.log(\"existingConnection\", existingConnection);\n\n\tif (existingConnection) {\n\t\treturn await checkConnectionStatus(client, connectionId, namespace);\n\t}\n\n\tconsole.log(\"creating connection\", connectionId);\n\tconst connection = await client.beta.connect.connections.set(connectionId, {\n\t\tnamespace,\n\t\tmcpUrl: serverUrl,\n\t\tname: server.displayName || server.qualifiedName,\n\t});\n\tconsole.log(\"connection\", connection);\n\n\tif (connection.status?.state === \"auth_required\") {\n\t\treturn {\n\t\t\tstatus: \"auth_required\",\n\t\t\tauthorizationUrl: connection.status?.authorizationUrl,\n\t\t};\n\t}\n\n\treturn {\n\t\tstatus: \"connected\",\n\t\tconnection,\n\t};\n}\n\n// Helper function to detect if input is a URL\nconst isValidUrl = (str: string): boolean => {\n\tif (!str.trim()) return false;\n\ttry {\n\t\tconst url = new URL(str.trim());\n\t\treturn url.protocol === 'http:' || url.protocol === 'https:';\n\t} catch {\n\t\treturn false;\n\t}\n};\n\ninterface ExternalURLDisplayProps {\n\turl: string;\n\ttoken: string;\n\tnamespace?: string;\n}\n\nconst ExternalURLDisplay = ({ url, token, namespace }: ExternalURLDisplayProps) => {\n\tconst queryClient = useQueryClient();\n\tconst [countdown, setCountdown] = useState<number | null>(null);\n\n\tconst { data: defaultNamespace } = useQuery({\n\t\tqueryKey: [\"defaultNamespace\", token],\n\t\tqueryFn: async () => {\n\t\t\tconst client = getSmitheryClient(token);\n\t\t\treturn await getDefaultNamespace(client);\n\t\t},\n\t\tenabled: !!token,\n\t});\n\n\tconst activeNamespace = namespace || defaultNamespace;\n\n\tconst {\n\t\tmutate: connect,\n\t\tisPending: isConnecting,\n\t\tdata: connectionData,\n\t\tmutateAsync: connectAsync,\n\t} = useMutation({\n\t\tmutationFn: async () => {\n\t\t\tif (!token || !activeNamespace) {\n\t\t\t\tthrow new Error(\"Token and namespace are required\");\n\t\t\t}\n\t\t\tconst client = getSmitheryClient(token);\n\t\t\tconst connectionId = generateConnectionId(token, url);\n\n\t\t\t// Check for existing connection\n\t\t\tconst existingConnection = await client.beta.connect.connections\n\t\t\t\t.get(connectionId, {\n\t\t\t\t\tnamespace: activeNamespace,\n\t\t\t\t})\n\t\t\t\t.catch(() => null);\n\n\t\t\tif (existingConnection) {\n\t\t\t\treturn await checkConnectionStatus(client, connectionId, activeNamespace);\n\t\t\t}\n\n\t\t\t// Create new connection\n\t\t\tconst connection = await client.beta.connect.connections.set(connectionId, {\n\t\t\t\tnamespace: activeNamespace,\n\t\t\t\tmcpUrl: url,\n\t\t\t\tname: url,\n\t\t\t});\n\n\t\t\tif (connection.status?.state === \"auth_required\") {\n\t\t\t\treturn {\n\t\t\t\t\tstatus: \"auth_required\" as const,\n\t\t\t\t\tauthorizationUrl: connection.status?.authorizationUrl,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tstatus: \"connected\" as const,\n\t\t\t\tconnection,\n\t\t\t};\n\t\t},\n\t\tonSuccess: () => {\n\t\t\tqueryClient.invalidateQueries({ queryKey: [\"connections\"] });\n\t\t},\n\t\tonError: (error) => {\n\t\t\tconsole.error(\"error connecting to external URL\", error);\n\t\t},\n\t});\n\n\t// Countdown timer for auth_required state\n\tuseEffect(() => {\n\t\tif (connectionData?.status === \"auth_required\" && countdown === null) {\n\t\t\tsetCountdown(3);\n\t\t}\n\t}, [connectionData?.status, countdown]);\n\n\tuseEffect(() => {\n\t\tif (countdown === null || countdown <= 0) return;\n\n\t\tconst timer = setTimeout(() => {\n\t\t\tsetCountdown(countdown - 1);\n\t\t}, 1000);\n\n\t\treturn () => clearTimeout(timer);\n\t}, [countdown]);\n\n\t// Auto-redirect when auth is required\n\tuseEffect(() => {\n\t\tif (\n\t\t\tconnectionData?.status === \"auth_required\" &&\n\t\t\tconnectionData.authorizationUrl &&\n\t\t\tcountdown === 0\n\t\t) {\n\t\t\twindow.open(connectionData.authorizationUrl, \"_blank\");\n\t\t}\n\t}, [connectionData, countdown]);\n\n\t// Poll connection status when auth_required\n\tuseEffect(() => {\n\t\tif (connectionData?.status !== \"auth_required\" || !token || !activeNamespace) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst pollInterval = setInterval(async () => {\n\t\t\ttry {\n\t\t\t\tconst client = getSmitheryClient(token);\n\t\t\t\tconst connectionId = generateConnectionId(token, url);\n\t\t\t\tconst status = await checkConnectionStatus(\n\t\t\t\t\tclient,\n\t\t\t\t\tconnectionId,\n\t\t\t\t\tactiveNamespace,\n\t\t\t\t);\n\n\t\t\t\tif (status.status === \"connected\") {\n\t\t\t\t\t// Update mutation data to trigger re-render\n\t\t\t\t\tawait connectAsync();\n\t\t\t\t\tsetCountdown(null);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"error checking connection status\", error);\n\t\t\t}\n\t\t}, 2000); // Check every 2 seconds\n\n\t\treturn () => clearInterval(pollInterval);\n\t}, [connectionData?.status, token, activeNamespace, url, connectAsync]);\n\n\treturn (\n\t\t<div className=\"mt-4 p-4 border rounded-md flex flex-col gap-4\">\n\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t<Avatar className=\"h-10 w-10 rounded-md\">\n\t\t\t\t\t<AvatarFallback className=\"rounded-md bg-muted\">\n\t\t\t\t\t\t<Link className=\"size-5\" />\n\t\t\t\t\t</AvatarFallback>\n\t\t\t\t</Avatar>\n\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t<h3 className=\"font-medium truncate\">External MCP Server</h3>\n\t\t\t\t\t<p className=\"text-muted-foreground text-xs truncate\">{url}</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{connectionData?.status === \"auth_required\" && (\n\t\t\t\t<AuthRequiredBanner\n\t\t\t\t\tserverName=\"this server\"\n\t\t\t\t\tauthorizationUrl={connectionData.authorizationUrl}\n\t\t\t\t\tcountdown={countdown}\n\t\t\t\t/>\n\t\t\t)}\n\n\t\t\t<div className=\"mt-2 flex justify-end gap-4\">\n\t\t\t\t<ConnectionButton\n\t\t\t\t\tconnectionStatus={connectionData?.status}\n\t\t\t\t\tisConnecting={isConnecting}\n\t\t\t\t\tonConnect={connect}\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t{connectionData?.status === \"error\" && (\n\t\t\t\t<p className=\"text-destructive text-sm mt-2\">\n\t\t\t\t\tError connecting to server\n\t\t\t\t</p>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n\nexport const ServerSearch = ({ token, namespace }: { token?: string, namespace?: string }) => {\n\tconst [query, setQuery] = useState(\"\");\n\tconst [selectedServer, setSelectedServer] =\n\t\tuseState<ServerListResponse | null>(null);\n\tconst [selectedExternalUrl, setSelectedExternalUrl] = useState<string | null>(null);\n\tconst debouncedQuery = useDebounce(query, 300);\n\tconst isUrl = isValidUrl(query);\n\n\tconst { data, isLoading } = useQuery({\n\t\tqueryKey: [\"servers\", token, debouncedQuery],\n\t\tqueryFn: async () => {\n\t\t\tif (!token) {\n\t\t\t\tthrow new Error(\"API token is required\");\n\t\t\t}\n\t\t\tconst client = getSmitheryClient(token);\n\t\t\tconsole.log(\"searching\", debouncedQuery);\n\t\t\tconst servers = debouncedQuery\n\t\t\t\t? await client.servers.list({ q: debouncedQuery, pageSize: 3 })\n\t\t\t\t: await client.servers.list();\n\t\t\tconsole.log(`servers for ${debouncedQuery}`, servers);\n\t\t\treturn servers;\n\t\t},\n\t\tenabled: !!token,\n\t});\n\n\tconst servers = data?.servers ?? [];\n\n\tconst handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n\t\tif (e.key === \"Enter\") {\n\t\t\te.preventDefault();\n\t\t\tif (isUrl) {\n\t\t\t\tconst urlToConnect = query.trim();\n\t\t\t\tsetSelectedExternalUrl(urlToConnect);\n\t\t\t\tsetSelectedServer(null);\n\t\t\t\tsetTimeout(() => setQuery(\"\"), 0);\n\t\t\t} else if (servers.length > 0) {\n\t\t\t\tsetSelectedServer(servers[0]);\n\t\t\t\tsetSelectedExternalUrl(null);\n\t\t\t\tsetTimeout(() => setQuery(\"\"), 0);\n\t\t\t}\n\t\t}\n\t};\n\n\treturn (\n\t\t<div className=\"max-w-md mx-auto\">\n\t\t\t<Combobox<ServerListResponse>\n\t\t\t\tvalue={selectedServer}\n\t\t\t\tonValueChange={(server) => {\n\t\t\t\t\tsetSelectedServer(server);\n\t\t\t\t\tsetSelectedExternalUrl(null);\n\t\t\t\t}}\n\t\t\t\tonInputValueChange={(value) => setQuery(value)}\n\t\t\t\titemToStringLabel={(server) =>\n\t\t\t\t\tserver.displayName || server.qualifiedName\n\t\t\t\t}\n\t\t\t>\n\t\t\t\t<ComboboxInput\n\t\t\t\t\tplaceholder=\"Search for a server or paste MCP URL...\"\n\t\t\t\t\tdisabled={!token}\n\t\t\t\t\tonKeyDown={handleKeyDown}\n\t\t\t\t/>\n\t\t\t\t<ComboboxContent side=\"bottom\" align=\"start\">\n\t\t\t\t\t{isUrl ? (\n\t\t\t\t\t\t<div className=\"p-1\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tclassName=\"data-highlighted:bg-accent data-highlighted:text-accent-foreground relative flex w-full cursor-pointer items-center gap-2 rounded-sm py-1.5 pr-2 pl-2 text-sm outline-hidden select-none hover:bg-accent hover:text-accent-foreground\"\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tconst urlToConnect = query.trim();\n\t\t\t\t\t\t\t\t\tsetSelectedExternalUrl(urlToConnect);\n\t\t\t\t\t\t\t\t\tsetSelectedServer(null);\n\t\t\t\t\t\t\t\t\tsetTimeout(() => setQuery(\"\"), 0);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Item size=\"sm\" className=\"p-0 min-w-0\">\n\t\t\t\t\t\t\t\t\t<ItemMedia>\n\t\t\t\t\t\t\t\t\t\t<Avatar className=\"h-8 w-8 rounded-md\">\n\t\t\t\t\t\t\t\t\t\t\t<AvatarFallback className=\"rounded-md bg-muted\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Link className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t\t\t\t</Avatar>\n\t\t\t\t\t\t\t\t\t</ItemMedia>\n\t\t\t\t\t\t\t\t\t<ItemContent className=\"min-w-0\">\n\t\t\t\t\t\t\t\t\t\t<ItemTitle className=\"w-full truncate\">\n\t\t\t\t\t\t\t\t\t\t\tConnect to external MCP URL\n\t\t\t\t\t\t\t\t\t\t</ItemTitle>\n\t\t\t\t\t\t\t\t\t\t<ItemDescription className=\"line-clamp-1 font-mono text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t{query.trim()}\n\t\t\t\t\t\t\t\t\t\t</ItemDescription>\n\t\t\t\t\t\t\t\t\t</ItemContent>\n\t\t\t\t\t\t\t\t</Item>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t{servers.length === 0 && (\n\t\t\t\t\t\t\t\t<ComboboxEmpty>\n\t\t\t\t\t\t\t\t\t{isLoading ? \"Loading...\" : \"No servers found.\"}\n\t\t\t\t\t\t\t\t</ComboboxEmpty>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t<ComboboxList className=\"max-h-[200px] overflow-y-auto\">\n\t\t\t\t\t\t\t\t{servers.map((server) => (\n\t\t\t\t\t\t\t\t\t<ComboboxItem key={server.qualifiedName} value={server}>\n\t\t\t\t\t\t\t\t\t\t<Item size=\"sm\" className=\"p-0 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t<ItemMedia>\n\t\t\t\t\t\t\t\t\t\t\t\t<Avatar className=\"h-8 w-8 rounded-md\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<AvatarImage src={server.iconUrl || \"\"} />\n\t\t\t\t\t\t\t\t\t\t\t\t\t<AvatarFallback className=\"rounded-md bg-muted text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{server.displayName?.charAt(0) ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tserver.qualifiedName?.charAt(0) ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"S\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</AvatarFallback>\n\t\t\t\t\t\t\t\t\t\t\t\t</Avatar>\n\t\t\t\t\t\t\t\t\t\t\t</ItemMedia>\n\t\t\t\t\t\t\t\t\t\t\t<ItemContent className=\"min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t<ItemTitle className=\"w-full truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{server.displayName || server.qualifiedName}\n\t\t\t\t\t\t\t\t\t\t\t\t</ItemTitle>\n\t\t\t\t\t\t\t\t\t\t\t\t<ItemDescription className=\"line-clamp-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{server.description || server.qualifiedName}\n\t\t\t\t\t\t\t\t\t\t\t\t</ItemDescription>\n\t\t\t\t\t\t\t\t\t\t\t</ItemContent>\n\t\t\t\t\t\t\t\t\t\t</Item>\n\t\t\t\t\t\t\t\t\t</ComboboxItem>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</ComboboxList>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</ComboboxContent>\n\t\t\t</Combobox>\n\n\t\t\t{selectedServer && token && namespace && (\n\t\t\t\t<ServerDisplay server={selectedServer} token={token} namespace={namespace} />\n\t\t\t)}\n\n\t\t\t{selectedExternalUrl && token && (\n\t\t\t\t<ExternalURLDisplay url={selectedExternalUrl} token={token} />\n\t\t\t)}\n\t\t</div>\n\t);\n};\n",
      "type": "registry:component",
      "target": "components/smithery/server-search.tsx"
    },
    {
      "path": "registry/new-york/smithery/tokens.tsx",
      "content": "\"use client\";\n\nimport { Button } from \"@/components/ui/button\";\nimport { useEffect, useState } from \"react\";\nimport { useAtom } from \"jotai\";\nimport type { CreateTokenResponse } from \"@smithery/api/resources/tokens.mjs\";\nimport {\n\tDialog,\n\tDialogContent,\n\tDialogHeader,\n\tDialogTitle,\n\tDialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n\tSelect,\n\tSelectContent,\n\tSelectItem,\n\tSelectTrigger,\n\tSelectValue,\n} from \"@/components/ui/select\";\nimport { Trash2 } from \"lucide-react\";\nimport { atom } from \"jotai\";\n\n// Atoms for token state management\nexport const tokensCreatedAtom = atom<CreateTokenResponse[]>([]);\nexport const selectedTokenAtom = atom<CreateTokenResponse | null>(null);\n\nexport function Tokens({\n\tinitialTokenResponse,\n\tonCreateToken,\n}: {\n\tinitialTokenResponse: CreateTokenResponse;\n\tonCreateToken?: () => Promise<CreateTokenResponse>;\n}) {\n\tconst [tokensCreated, setTokensCreated] = useAtom(tokensCreatedAtom);\n\tconst [selectedToken, setSelectedToken] = useAtom(selectedTokenAtom);\n\tconst [isOpen, setIsOpen] = useState(false);\n\n\tuseEffect(() => {\n\t\tsetTokensCreated((prev) => {\n\t\t\t// Only add if it doesn't already exist\n\t\t\tif (prev.some((token) => token.token === initialTokenResponse.token)) {\n\t\t\t\treturn prev;\n\t\t\t}\n\t\t\treturn [...prev, initialTokenResponse];\n\t\t});\n\t}, [initialTokenResponse, setTokensCreated]);\n\n\tuseEffect(() => {\n\t\tif (!selectedToken && tokensCreated.length > 0) {\n\t\t\tsetSelectedToken(tokensCreated[0]);\n\t\t}\n\t}, [selectedToken, setSelectedToken, tokensCreated]);\n\n\tconst handleRemoveToken = () => {\n\t\tif (!selectedToken) return;\n\n\t\tsetTokensCreated((prev) =>\n\t\t\tprev.filter((token) => token.token !== selectedToken.token),\n\t\t);\n\t\tsetSelectedToken(null);\n\t};\n\n\tif (!selectedToken) return null;\n\n\treturn (\n\t\t<div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n\t\t\t<span>\n\t\t\t\tUsing token:{\" \"}\n\t\t\t\t{selectedToken.token.startsWith(\"v4.public\")\n\t\t\t\t\t? \"Service Token\"\n\t\t\t\t\t: \"Root API Key\"}{\" \"}\n\t\t\t\t*****{selectedToken.token.slice(-4)}\n\t\t\t</span>\n\t\t\t<Dialog open={isOpen} onOpenChange={setIsOpen}>\n\t\t\t\t<DialogTrigger asChild>\n\t\t\t\t\t<Button variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\tModify\n\t\t\t\t\t</Button>\n\t\t\t\t</DialogTrigger>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>Manage Tokens</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t{tokensCreated.length > 1 && (\n\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t<div className=\"text-sm font-medium\">Select Token</div>\n\t\t\t\t\t\t\t\t<Select\n\t\t\t\t\t\t\t\t\tvalue={selectedToken.token}\n\t\t\t\t\t\t\t\t\tonValueChange={(tokenValue) => {\n\t\t\t\t\t\t\t\t\t\tconst token = tokensCreated.find((t) => t.token === tokenValue);\n\t\t\t\t\t\t\t\t\t\tif (token) setSelectedToken(token);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<SelectTrigger className=\"w-full\">\n\t\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t\t{tokensCreated.map((token) => (\n\t\t\t\t\t\t\t\t\t\t\t<SelectItem key={token.token} value={token.token}>\n\t\t\t\t\t\t\t\t\t\t\t\t{token.token.startsWith(\"v4.public\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"Service Token\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"Root API Key\"}\n\t\t\t\t\t\t\t\t\t\t\t\t: *****{token.token.slice(-4)}\n\t\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t<div className=\"rounded-lg border p-4 space-y-2\">\n\t\t\t\t\t\t\t<div className=\"flex items-start justify-between\">\n\t\t\t\t\t\t\t\t<div className=\"space-y-1\">\n\t\t\t\t\t\t\t\t\t<div className=\"font-medium\">\n\t\t\t\t\t\t\t\t\t\t{selectedToken.token.startsWith(\"v4.public\")\n\t\t\t\t\t\t\t\t\t\t\t? \"Service Token\"\n\t\t\t\t\t\t\t\t\t\t\t: \"Root API Key\"}\n\t\t\t\t\t\t\t\t\t\t: *****{selectedToken.token.slice(-4)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{selectedToken.expiresAt !== \"never\" && (\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\tExpires: {new Date(selectedToken.expiresAt).toLocaleString()}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{tokensCreated.length > 1 &&\n\t\t\t\t\t\t\t\t\tselectedToken.expiresAt !== \"never\" && (\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"icon-sm\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={handleRemoveToken}\n\t\t\t\t\t\t\t\t\t\t\taria-label=\"Remove token\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"flex  gap-2\">\n\t\t\t\t\t\t\t{onCreateToken && (\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\tonCreateToken().then((tokenResponse) => {\n\t\t\t\t\t\t\t\t\t\t\tsetTokensCreated([...tokensCreated, tokenResponse]);\n\t\t\t\t\t\t\t\t\t\t\tsetSelectedToken(tokenResponse);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\t\t\tclassName=\"flex-1\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tCreate New Token\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t<Button onClick={() => setIsOpen(false)} className=\"flex-1\">\n\t\t\t\t\t\t\t\tDone\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</div>\n\t);\n}\n",
      "type": "registry:component",
      "target": "components/smithery/tokens.tsx"
    },
    {
      "path": "registry/new-york/smithery/tool-search.tsx",
      "content": "\"use client\";\n\nimport Smithery from \"@smithery/api\";\nimport type { ToolSearchResponse } from \"@smithery/api/resources/beta/connect/tools.mjs\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { WrenchIcon } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useDebounce } from \"@/hooks/use-debounce\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Empty, EmptyDescription, EmptyHeader, EmptyTitle } from \"@/components/ui/empty\";\nimport { Input } from \"@/components/ui/input\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Spinner } from \"@/components/ui/spinner\";\nimport { ServerSearch } from \"./server-search\";\n\nasync function getDefaultNamespace(client: Smithery) {\n\tconst namespaces = await client.namespaces.list();\n\tif (namespaces.namespaces.length === 0) {\n\t\tthrow new Error(\"No namespaces found\");\n\t}\n\treturn namespaces.namespaces[0].name;\n}\n\nconst getSmitheryClient = (token: string) => {\n\treturn new Smithery({\n\t\tapiKey: token,\n\t\tbaseURL: process.env.NEXT_PUBLIC_SMITHERY_API_URL,\n\t})\n};\n\ntype ToolCardProps = {\n\ttool: ToolSearchResponse.Tool;\n};\n\nconst ToolCard = ({ tool }: ToolCardProps) => {\n\tconst toolName = tool.tool.name;\n\tconst toolDescription = tool.tool.description;\n\tconst serverUrl = tool.serverUrl;\n\tconst inputSchema = tool.tool.inputSchema;\n\n\treturn (\n\t\t<Card className=\"border-none shadow-none\">\n\t\t\t<CardContent className=\"flex items-center gap-4\">\n\t\t\t\t<Avatar className=\"h-10 w-10 rounded-md\">\n\t\t\t\t\t<AvatarFallback className=\"rounded-md bg-muted\">\n\t\t\t\t\t\t<WrenchIcon className=\"h-5 w-5 text-muted-foreground\" />\n\t\t\t\t\t</AvatarFallback>\n\t\t\t\t</Avatar>\n\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t<h3 className=\"font-medium truncate\">{toolName}</h3>\n\t\t\t\t\t<p className=\"text-muted-foreground text-xs truncate\">{serverUrl}</p>\n\t\t\t\t\t{toolDescription && (\n\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs truncate\">\n\t\t\t\t\t\t\t{toolDescription}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t)}\n\t\t\t\t\t{inputSchema && Object.keys(inputSchema).length > 0 && (\n\t\t\t\t\t\t<details className=\"mt-2\">\n\t\t\t\t\t\t\t<summary className=\"text-xs text-muted-foreground cursor-pointer hover:text-foreground\">\n\t\t\t\t\t\t\t\tView parameters\n\t\t\t\t\t\t\t</summary>\n\t\t\t\t\t\t\t<pre className=\"mt-2 text-xs bg-muted/50 p-2 rounded overflow-x-auto\">\n\t\t\t\t\t\t\t\t{JSON.stringify(inputSchema, null, 2)}\n\t\t\t\t\t\t\t</pre>\n\t\t\t\t\t\t</details>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</CardContent>\n\t\t</Card>\n\t);\n};\n\nexport const ToolSearch = ({ token }: { token?: string }) => {\n\tconst [query, setQuery] = useState(\"\");\n\tconst debouncedQuery = useDebounce(query, 300);\n\n\tconst { data, isLoading, error } = useQuery({\n\t\tqueryKey: [\"tools\", token, debouncedQuery],\n\t\tqueryFn: async () => {\n\t\t\tif (!token) {\n\t\t\t\tthrow new Error(\"API token is required\");\n\t\t\t}\n\t\t\tconst client = getSmitheryClient(token);\n\t\t\tconsole.log(\"searching\", debouncedQuery);\n\t\t\tconst namespace = await getDefaultNamespace(client);\n\t\t\tconst tools = await client.beta.connect.tools.search(namespace, debouncedQuery.length > 0 ? { q: debouncedQuery } : {});\n\t\t\tconsole.log(`tools for ${debouncedQuery}`, tools);\n\t\t\treturn tools;\n\t\t},\n\t\tenabled: !!token,\n\t});\n\n\treturn (\n\t\t<div className=\"max-w-md mx-auto\">\n\t\t\t<div className=\"mb-4\">\n\t\t\t\t<Input\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tvalue={query}\n\t\t\t\t\tonChange={(e) => setQuery(e.target.value)}\n\t\t\t\t\tplaceholder=\"Search for a tool\"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t{/* Loading State */}\n\t\t\t{isLoading && (\n\t\t\t\t<div className=\"flex items-center gap-2 text-muted-foreground py-4\">\n\t\t\t\t\t<Spinner />\n\t\t\t\t\t<span>Searching tools...</span>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t{/* Error State */}\n\t\t\t{error && (\n\t\t\t\t<div className=\"rounded-md bg-destructive/10 p-4\">\n\t\t\t\t\t<p className=\"text-destructive text-sm\">Error: {error.message}</p>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t{/* Empty State */}\n\t\t\t{!isLoading && !error && data?.tools && data.tools.length === 0 && (\n\t\t\t\t<Empty>\n\t\t\t\t\t<EmptyHeader>\n\t\t\t\t\t\t<EmptyTitle>No tools found</EmptyTitle>\n\t\t\t\t\t\t<EmptyDescription>\n\t\t\t\t\t\t\tTry a different search term or add a server below\n\t\t\t\t\t\t</EmptyDescription>\n\t\t\t\t\t</EmptyHeader>\n\t\t\t\t</Empty>\n\t\t\t)}\n\n\t\t\t{/* Unified scrollable container for all results */}\n\t\t\t{!isLoading && !error && (\n\t\t\t\t<div className=\"space-y-4 overflow-auto max-h-[500px]\">\n\t\t\t\t\t{/* Tool Results */}\n\t\t\t\t\t{data?.tools && data.tools.length > 0 && (\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t{data.tools.map((tool: ToolSearchResponse.Tool) => (\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tkey={`${tool.serverUrl}-${tool.connectionId}-${tool.tool.name}`}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<ToolCard tool={tool} />\n\t\t\t\t\t\t\t\t\t<Separator />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* Server Search Section - shows automatically with same query */}\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<h2 className=\"text-lg font-semibold\">Explore Servers</h2>\n\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground mt-1\">\n\t\t\t\t\t\t\t\tIf the tool you want isn't showing up, try adding another\n\t\t\t\t\t\t\t\tserver\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<ServerSearch token={token} />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n",
      "type": "registry:component",
      "target": "components/smithery/tool-search.tsx"
    },
    {
      "path": "registry/new-york/hooks/use-debounce.ts",
      "content": "import { useEffect, useState } from \"react\";\n\nexport function useDebounce<T>(value: T, delay: number): T {\n\tconst [debouncedValue, setDebouncedValue] = useState<T>(value);\n\n\tuseEffect(() => {\n\t\tconst handler = setTimeout(() => {\n\t\t\tsetDebouncedValue(value);\n\t\t}, delay);\n\n\t\treturn () => {\n\t\t\tclearTimeout(handler);\n\t\t};\n\t}, [value, delay]);\n\n\treturn debouncedValue;\n}\n",
      "type": "registry:hook",
      "target": "hooks/use-debounce.ts"
    }
  ],
  "type": "registry:block"
}