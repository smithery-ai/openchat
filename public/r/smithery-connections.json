{
	"$schema": "https://ui.shadcn.com/schema/registry-item.json",
	"name": "smithery-connections",
	"title": "Smithery Connections",
	"description": "A component for managing and displaying MCP server connections via Smithery.",
	"dependencies": ["@smithery/api", "@tanstack/react-query", "lucide-react"],
	"registryDependencies": ["avatar", "button", "card", "separator"],
	"files": [
		{
			"path": "registry/new-york/smithery/connections.tsx",
			"content": "\"use client\";\n\nimport Smithery, { AuthenticationError } from \"@smithery/api\";\nimport type { Connection } from \"@smithery/api/resources/beta/connect/connections.mjs\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { Link as LinkIcon, RefreshCw, Trash2 } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\n\nasync function getDefaultNamespace(client: Smithery) {\n\tconst namespaces = await client.namespaces.list();\n\tif (namespaces.namespaces.length === 0) {\n\t\tthrow new Error(\"No namespaces found\");\n\t}\n\treturn namespaces.namespaces[0].name;\n}\n\nconst getSmitheryClient = (token: string) => {\n\treturn new Smithery({\n\t\tapiKey: token,\n\t\tbaseURL: process.env.NEXT_PUBLIC_SMITHERY_API_URL,\n\t})\n};\n\ntype ConnectionStatus =\n\t| { status: \"connected\"; connection: Connection }\n\t| { status: \"auth_required\"; authorizationUrl?: string }\n\t| { status: \"error\"; error: unknown };\n\nasync function checkConnectionStatus(\n\tclient: Smithery,\n\tconnectionId: string,\n\tnamespace: string,\n): Promise<ConnectionStatus> {\n\ttry {\n\t\tconst jsonRpcResponse = await client.beta.connect.rpc.call(connectionId, {\n\t\t\tnamespace,\n\t\t\tjsonrpc: \"2.0\",\n\t\t\tmethod: \"tools/list\",\n\t\t});\n\t\tconsole.log(\"jsonRpcResponse\", jsonRpcResponse);\n\n\t\tconst connection = await client.beta.connect.connections.get(connectionId, {\n\t\t\tnamespace: namespace,\n\t\t});\n\n\t\treturn {\n\t\t\tstatus: \"connected\",\n\t\t\tconnection,\n\t\t};\n\t} catch (error) {\n\t\tif (error instanceof AuthenticationError) {\n\t\t\tconst errorData = error.error as unknown as {\n\t\t\t\terror?: { data?: { authorizationUrl?: string } };\n\t\t\t\tdata?: { authorizationUrl?: string };\n\t\t\t};\n\t\t\tconst authorizationUrl =\n\t\t\t\terrorData?.error?.data?.authorizationUrl ||\n\t\t\t\terrorData?.data?.authorizationUrl;\n\t\t\treturn {\n\t\t\t\tstatus: \"auth_required\",\n\t\t\t\tauthorizationUrl,\n\t\t\t};\n\t\t}\n\t\tconsole.error(\"error connecting to server\", error);\n\t\treturn {\n\t\t\tstatus: \"error\",\n\t\t\terror,\n\t\t};\n\t}\n}\n\nexport const ConnectionCard = ({\n\tconnection,\n\ttoken,\n\tnamespace,\n}: {\n\tconnection: Connection;\n\ttoken: string;\n\tnamespace: string;\n}) => {\n\tconst queryClient = useQueryClient();\n\tconst [testConnectionData, setTestConnectionData] = useState<ConnectionStatus | null>(null);\n\n\tconst deleteMutation = useMutation({\n\t\tmutationFn: async () => {\n\t\t\tconst client = getSmitheryClient(token);\n\t\t\tawait client.beta.connect.connections.delete(connection.connectionId, {\n\t\t\t\tnamespace: namespace,\n\t\t\t});\n\t\t},\n\t\tonSuccess: () => {\n\t\t\tqueryClient.invalidateQueries({ queryKey: [\"connections\"] });\n\t\t},\n\t});\n\n\tconst testMutation = useMutation({\n\t\tmutationFn: async () => {\n\t\t\tconst client = getSmitheryClient(token);\n\t\t\treturn await checkConnectionStatus(\n\t\t\t\tclient,\n\t\t\t\tconnection.connectionId,\n\t\t\t\tnamespace,\n\t\t\t);\n\t\t},\n\t\tonSuccess: (data) => {\n\t\t\tsetTestConnectionData(data);\n\t\t},\n\t\tonError: (error) => {\n\t\t\tconsole.error(\"error testing connection\", error);\n\t\t\tsetTestConnectionData({\n\t\t\t\tstatus: \"error\",\n\t\t\t\terror,\n\t\t\t});\n\t\t},\n\t});\n\n\treturn (\n\t\t<Card className=\"border-none shadow-none\">\n\t\t\t<CardContent className=\"flex items-center gap-4\">\n\t\t\t\t<Avatar className=\"h-10 w-10 rounded-md\">\n\t\t\t\t\t<AvatarImage src={connection.iconUrl || \"\"} />\n\t\t\t\t\t<AvatarFallback className=\"rounded-md bg-muted\">\n\t\t\t\t\t\t{connection.name.charAt(0)}\n\t\t\t\t\t</AvatarFallback>\n\t\t\t\t</Avatar>\n\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t<h3 className=\"font-medium truncate\">{connection.name}</h3>\n\t\t\t\t\t<p className=\"text-muted-foreground text-xs truncate\">\n\t\t\t\t\t\t{connection.connectionId}\n\t\t\t\t\t</p>\n\t\t\t\t\t<p className=\"text-muted-foreground text-xs truncate\">\n\t\t\t\t\t\t{connection.mcpUrl}\n\t\t\t\t\t</p>\n\t\t\t\t\t<p className=\"text-muted-foreground text-xs truncate\">\n\t\t\t\t\t\t{new Date(connection.createdAt || \"\").toLocaleDateString()}{\" \"}\n\t\t\t\t\t\t{new Date(connection.createdAt || \"\").toLocaleTimeString()}\n\t\t\t\t\t</p>\n\t\t\t\t\t<p className=\"text-muted-foreground text-xs truncate\">\n\t\t\t\t\t\t{connection.metadata && JSON.stringify(connection.metadata)}\n\t\t\t\t\t</p>\n\t\t\t\t\t{testConnectionData?.status === \"connected\" && (\n\t\t\t\t\t\t<p className=\"text-green-600 text-xs\">Connected</p>\n\t\t\t\t\t)}\n\t\t\t\t\t{testConnectionData?.status === \"auth_required\" &&\n\t\t\t\t\t\ttestConnectionData?.authorizationUrl && (\n\t\t\t\t\t\t\t<div className=\"mt-2\">\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\twindow.open(\n\t\t\t\t\t\t\t\t\t\t\ttestConnectionData.authorizationUrl,\n\t\t\t\t\t\t\t\t\t\t\t\"_blank\",\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tAuthorize\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t{testConnectionData?.status === \"error\" && (\n\t\t\t\t\t\t<p className=\"text-destructive text-xs\">\n\t\t\t\t\t\t\tError:{\" \"}\n\t\t\t\t\t\t\t{testConnectionData.error instanceof Error\n\t\t\t\t\t\t\t\t? testConnectionData.error.message\n\t\t\t\t\t\t\t\t: \"Unknown error\"}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\tonClick={() => testMutation.mutate()}\n\t\t\t\t\tdisabled={testMutation.isPending}\n\t\t\t\t\ttitle=\"Test connection\"\n\t\t\t\t>\n\t\t\t\t\t<LinkIcon className=\"h-4 w-4\" />\n\t\t\t\t</Button>\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\tonClick={() => deleteMutation.mutate()}\n\t\t\t\t\tdisabled={deleteMutation.isPending}\n\t\t\t\t>\n\t\t\t\t\t<Trash2 className=\"h-4 w-4\" />\n\t\t\t\t</Button>\n\t\t\t</CardContent>\n\t\t</Card>\n\t);\n};\n\nexport const Connections = ({ token, namespace }: { token: string, namespace?: string }) => {\n\tconst { data, isLoading, error, refetch, isFetching } = useQuery({\n\t\tqueryKey: [\"connections\", token],\n\t\tqueryFn: async () => {\n\t\t\tif (!token) {\n\t\t\t\tthrow new Error(\"API token is required\");\n\t\t\t}\n\t\t\tconst client = getSmitheryClient(token);\n\t\t\tconst namespaceToUse = namespace || await getDefaultNamespace(client);\n\t\t\tconst connections = await client.beta.connect.connections.list(namespaceToUse);\n\t\t\treturn { connections, namespace: namespaceToUse };\n\t\t},\n\t\tenabled: !!token,\n\t});\n\n\treturn (\n\t\t<div className=\"max-w-md mx-auto\">\n\t\t\t<div className=\"flex items-center justify-between mb-4\">\n\t\t\t\t<h2 className=\"text-lg font-semibold\">Connections</h2>\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\tonClick={() => refetch()}\n\t\t\t\t\tdisabled={isFetching}\n\t\t\t\t\ttitle=\"Refresh connections\"\n\t\t\t\t>\n\t\t\t\t\t<RefreshCw className={`h-4 w-4 ${isFetching ? \"animate-spin\" : \"\"}`} />\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t\t{isLoading && <p className=\"text-muted-foreground\">Loading...</p>}\n\t\t\t{error && <p className=\"text-destructive\">Error: {error.message}</p>}\n\t\t\t{data && (\n\t\t\t\t<div className=\"space-y-2 overflow-auto max-h-[500px]\">\n\t\t\t\t\t{data.connections.connections.length === 0 && <p className=\"text-muted-foreground\">No connections found</p>}\n\t\t\t\t\t{data.connections.connections.map((connection: Connection) => (\n\t\t\t\t\t\t<div key={connection.connectionId}>\n\t\t\t\t\t\t\t<ConnectionCard\n\t\t\t\t\t\t\t\tconnection={connection}\n\t\t\t\t\t\t\t\ttoken={token}\n\t\t\t\t\t\t\t\tnamespace={data.namespace}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<Separator />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t))}\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n",
			"type": "registry:component",
			"target": "components/smithery/connections.tsx"
		}
	],
	"type": "registry:block"
}
