{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "smithery-connections",
  "title": "Smithery Connections",
  "description": "A component for managing and displaying MCP server connections via Smithery.",
  "dependencies": [
    "@ai-sdk/mcp",
    "@smithery/api",
    "@tanstack/react-query",
    "ai",
    "lucide-react"
  ],
  "registryDependencies": [
    "avatar",
    "button",
    "card",
    "separator",
    "toggle",
    "smithery-connection-context",
    "smithery-server-search",
    "smithery-tools-panel"
  ],
  "files": [
    {
      "path": "registry/new-york/smithery/connections.tsx",
      "content": "\"use client\";\n\nimport { createMCPClient } from \"@ai-sdk/mcp\";\nimport Smithery from \"@smithery/api\";\nimport { SmitheryTransport } from \"@smithery/api/mcp\";\nimport type { Connection } from \"@smithery/api/resources/beta/connect/connections.mjs\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport type { ToolExecutionOptions } from \"ai\";\nimport { Plus, RefreshCw, Trash2, X } from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Toggle } from \"@/components/ui/toggle\";\nimport { ServerSearch } from \"@/registry/new-york/smithery/server-search\";\nimport { ToolsPanel } from \"@/registry/new-york/smithery/tools-panel\";\nimport {\n\tConnectionConfigContext,\n\tuseConnectionConfig,\n} from \"@/registry/new-york/smithery/connection-context\";\n\n// Re-export useConnectionConfig for backward compatibility\nexport { useConnectionConfig };\n\nasync function getDefaultNamespace(client: Smithery) {\n\tconst namespaces = await client.namespaces.list();\n\tif (namespaces.namespaces.length === 0) {\n\t\tthrow new Error(\"No namespaces found\");\n\t}\n\treturn namespaces.namespaces[0].name;\n}\n\nconst getSmitheryClient = (token: string) => {\n\treturn new Smithery({\n\t\tapiKey: token,\n\t\tbaseURL: process.env.NEXT_PUBLIC_SMITHERY_API_URL,\n\t});\n};\n\nexport const ConnectionCard = ({\n\tconnection,\n\ttoken,\n\tnamespace,\n\tclassName,\n\t...rest\n}: {\n\tconnection: Connection;\n\ttoken: string;\n\tnamespace: string;\n\tclassName?: string;\n} & React.HTMLAttributes<HTMLDivElement>) => {\n\tconst queryClient = useQueryClient();\n\tconst deleteMutation = useMutation({\n\t\tmutationFn: async () => {\n\t\t\tconst client = getSmitheryClient(token);\n\t\t\tawait client.beta.connect.connections.delete(connection.connectionId, {\n\t\t\t\tnamespace: namespace,\n\t\t\t});\n\t\t},\n\t\tonSuccess: () => {\n\t\t\tqueryClient.invalidateQueries({ queryKey: [\"connections\"] });\n\t\t},\n\t});\n\n\treturn (\n\t\t<Card className={cn(\"border-none shadow-none\", className || \"\")} {...rest}>\n\t\t\t<CardContent className=\"flex items-center gap-4\">\n\t\t\t\t<Avatar className=\"h-10 w-10 rounded-md\">\n\t\t\t\t\t<AvatarImage src={connection.iconUrl || \"\"} />\n\t\t\t\t\t<AvatarFallback className=\"rounded-md bg-muted\">\n\t\t\t\t\t\t{connection.name.charAt(0)}\n\t\t\t\t\t</AvatarFallback>\n\t\t\t\t</Avatar>\n\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t<h3 className=\"font-medium truncate flex items-center gap-2\">\n\t\t\t\t\t\t{connection.name}\n\t\t\t\t\t\t{connection.connectionId && (\n\t\t\t\t\t\t\t<span className=\"ml-2 text-xs font-mono text-muted-foreground bg-muted px-2 py-0.5 rounded\">\n\t\t\t\t\t\t\t\t{\"â€¢\".repeat(Math.min(connection.connectionId.length - 10, 4))}\n\t\t\t\t\t\t\t\t{connection.connectionId.slice(-10)}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</h3>\n\t\t\t\t\t<p className=\"text-muted-foreground text-xs truncate\">\n\t\t\t\t\t\t{connection.mcpUrl}\n\t\t\t\t\t</p>\n\t\t\t\t\t<p className=\"text-muted-foreground text-xs truncate\">\n\t\t\t\t\t\t{new Date(connection.createdAt || \"\").toLocaleDateString()}{\" \"}\n\t\t\t\t\t\t{new Date(connection.createdAt || \"\").toLocaleTimeString()}\n\t\t\t\t\t</p>\n\t\t\t\t\t<p className=\"text-muted-foreground text-xs truncate\">\n\t\t\t\t\t\t{connection.metadata && JSON.stringify(connection.metadata)}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\tonClick={() => deleteMutation.mutate()}\n\t\t\t\t\tdisabled={deleteMutation.isPending}\n\t\t\t\t>\n\t\t\t\t\t<Trash2 className=\"h-4 w-4\" />\n\t\t\t\t</Button>\n\t\t\t</CardContent>\n\t\t</Card>\n\t);\n};\n\nexport const ConnectionsList = ({\n\ttoken,\n\tnamespace,\n\tdefaultActiveConnectionId,\n\tonActiveConnectionIdChange,\n\tdefaultShowSearchServers = true,\n}: {\n\ttoken: string;\n\tnamespace?: string;\n\tdefaultActiveConnectionId?: string;\n\tonActiveConnectionIdChange: (connectionId: string) => void;\n\tdefaultShowSearchServers?: boolean;\n}) => {\n\tconst [activeConnectionId, setActiveConnectionId] = useState<string | null>(\n\t\tdefaultActiveConnectionId || null,\n\t);\n\tconst [showSearchServers, setShowSearchServers] = useState(\n\t\tdefaultShowSearchServers || false,\n\t);\n\tconst { data, isLoading, error, refetch, isFetching } = useQuery({\n\t\tqueryKey: [\"connections\", token],\n\t\tqueryFn: async () => {\n\t\t\tif (!token) {\n\t\t\t\tthrow new Error(\"API token is required\");\n\t\t\t}\n\t\t\tconst client = getSmitheryClient(token);\n\t\t\tconst namespaceToUse = namespace || (await getDefaultNamespace(client));\n\t\t\tconst { connections } =\n\t\t\t\tawait client.beta.connect.connections.list(namespaceToUse);\n\t\t\treturn { connections, namespace: namespaceToUse };\n\t\t},\n\t\tenabled: !!token,\n\t});\n\n\tuseEffect(() => {\n\t\tif (data?.connections && !defaultActiveConnectionId) {\n\t\t\tsetActiveConnectionId(data?.connections[0]?.connectionId || null);\n\t\t}\n\t}, [data?.connections, defaultActiveConnectionId]);\n\n\tuseEffect(() => {\n\t\tif (activeConnectionId) {\n\t\t\tonActiveConnectionIdChange(activeConnectionId);\n\t\t}\n\t}, [activeConnectionId, onActiveConnectionIdChange]);\n\n\treturn (\n\t\t<div className=\"max-w-md flex flex-col h-full\">\n\t\t\t<div className=\"flex items-center justify-between px-6 py-3\">\n\t\t\t\t<h2 className=\"text-lg font-semibold\">Connections</h2>\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t<Toggle\n\t\t\t\t\t\tdefaultPressed={defaultShowSearchServers}\n\t\t\t\t\t\tonPressedChange={setShowSearchServers}\n\t\t\t\t\t>\n\t\t\t\t\t\t{showSearchServers ? (\n\t\t\t\t\t\t\t<X className=\"h-4 w-4\" />\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<Plus className=\"h-4 w-4\" />\n\t\t\t\t\t\t)}\n\t\t\t\t\t</Toggle>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\t\tonClick={() => refetch()}\n\t\t\t\t\t\tdisabled={isFetching}\n\t\t\t\t\t\ttitle=\"Refresh connections\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<RefreshCw\n\t\t\t\t\t\t\tclassName={`h-4 w-4 ${isFetching ? \"animate-spin\" : \"\"}`}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className=\"flex-1 flex flex-col\">\n\t\t\t\t{showSearchServers && (\n\t\t\t\t\t<div className=\"px-6 pb-4\">\n\t\t\t\t\t\t<ServerSearch token={token} namespace={data?.namespace} />\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t\t{isLoading && <p className=\"text-muted-foreground px-6\">Loading...</p>}\n\t\t\t\t{error && (\n\t\t\t\t\t<p className=\"text-destructive px-6\">Error: {error.message}</p>\n\t\t\t\t)}\n\t\t\t\t{data && (\n\t\t\t\t\t<div className=\"overflow-auto flex-1\">\n\t\t\t\t\t\t{data.connections.length === 0 && (\n\t\t\t\t\t\t\t<p className=\"text-muted-foreground px-6\">No connections found</p>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{data.connections.map((connection: Connection) => (\n\t\t\t\t\t\t\t<div key={`${connection.connectionId}-${data.namespace}`}>\n\t\t\t\t\t\t\t\t<Separator />\n\t\t\t\t\t\t\t\t<ConnectionCard\n\t\t\t\t\t\t\t\t\tconnection={connection}\n\t\t\t\t\t\t\t\t\ttoken={token}\n\t\t\t\t\t\t\t\t\tnamespace={data.namespace}\n\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\"rounded-none\",\n\t\t\t\t\t\t\t\t\t\tactiveConnectionId === connection.connectionId\n\t\t\t\t\t\t\t\t\t\t\t? \"bg-muted\"\n\t\t\t\t\t\t\t\t\t\t\t: \"hover:bg-muted/50 hover:cursor-pointer\",\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\tonClick={() => setActiveConnectionId(connection.connectionId)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n\nconst ActiveConnection = ({\n\ttoken,\n\tnamespace,\n\tconnectionId,\n}: {\n\ttoken: string;\n\tnamespace?: string;\n\tconnectionId: string;\n}) => {\n\tconst { data, isLoading, error } = useQuery({\n\t\tqueryKey: [\"connection\", connectionId, token, namespace],\n\t\tqueryFn: async () => {\n\t\t\tconst client = getSmitheryClient(token);\n\t\t\tconst namespaceToUse = namespace || (await getDefaultNamespace(client));\n\t\t\tconst data = await client.beta.connect.connections.get(connectionId, {\n\t\t\t\tnamespace: namespaceToUse,\n\t\t\t});\n\t\t\treturn { namespace: namespaceToUse, ...data };\n\t\t},\n\t});\n\n\tconst clientQuery = useQuery({\n\t\tqueryKey: [\"mcp-client\", token, connectionId, namespace],\n\t\tqueryFn: async () => {\n\t\t\tconst namespaceToUse =\n\t\t\t\tnamespace || (await getDefaultNamespace(getSmitheryClient(token)));\n\t\t\tconst transport = new SmitheryTransport({\n\t\t\t\tclient: getSmitheryClient(token),\n\t\t\t\tconnectionId: connectionId,\n\t\t\t\tnamespace: namespaceToUse,\n\t\t\t});\n\t\t\tconst mcpClient = await createMCPClient({ transport });\n\t\t\treturn mcpClient;\n\t\t},\n\t\tenabled: !!connectionId,\n\t});\n\n\tconst toolsQuery = useQuery({\n\t\tqueryKey: [\"tools\", connectionId, token, namespace],\n\t\tqueryFn: async () => {\n\t\t\tif (!clientQuery.data) {\n\t\t\t\tthrow new Error(\"Client not available\");\n\t\t\t}\n\t\t\tconst client = clientQuery.data;\n\t\t\treturn await client.tools();\n\t\t},\n\t\tenabled: !!clientQuery.data,\n\t});\n\tconst handleExecute = async (\n\t\ttoolName: string,\n\t\tparams: Record<string, unknown>,\n\t) => {\n\t\tif (!toolsQuery.data) {\n\t\t\tthrow new Error(\"Tools not available\");\n\t\t}\n\t\tconst tool = toolsQuery.data[toolName];\n\t\tif (!tool) {\n\t\t\tthrow new Error(`Tool ${toolName} not found`);\n\t\t}\n\t\t// The execute method from AI SDK tools expects (params, options)\n\t\t// We're executing tools directly, so provide minimal required options\n\t\tconst options: ToolExecutionOptions = {\n\t\t\ttoolCallId: `manual-${Date.now()}`,\n\t\t\tmessages: [],\n\t\t};\n\t\treturn await tool.execute(params, options);\n\t};\n\n\treturn (\n\t\t<div className=\"w-full h-full flex flex-col overflow-auto\">\n\t\t\t<div className=\"w-full h-full flex flex-col\">\n\t\t\t\t{isLoading && (\n\t\t\t\t\t<div className=\"p-6\">\n\t\t\t\t\t\t<p className=\"text-muted-foreground\">Loading connection...</p>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t\t{error && (\n\t\t\t\t\t<div className=\"p-6\">\n\t\t\t\t\t\t<p className=\"text-destructive\">Error: {error.message}</p>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t\t{data && (\n\t\t\t\t\t<div className=\"border-b p-6\">\n\t\t\t\t\t\t<h1 className=\"text-xl font-semibold mb-3\">{data.name}</h1>\n\t\t\t\t\t\t<div className=\"space-y-1 text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t<p>ID: {data.connectionId}</p>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\tCreated: {new Date(data.createdAt || \"\").toLocaleDateString()}{\" \"}\n\t\t\t\t\t\t\t\t{new Date(data.createdAt || \"\").toLocaleTimeString()}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t{data.metadata && (\n\t\t\t\t\t\t\t\t<p>Metadata: {JSON.stringify(data.metadata)}</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t\t{toolsQuery.isLoading && (\n\t\t\t\t\t<div className=\"p-6\">\n\t\t\t\t\t\t<p className=\"text-muted-foreground\">Loading tools...</p>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t\t{toolsQuery.error && (\n\t\t\t\t\t<div className=\"p-6\">\n\t\t\t\t\t\t<p className=\"text-destructive\">\n\t\t\t\t\t\t\tError: {toolsQuery.error.message}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t\t{toolsQuery.data && data && (\n\t\t\t\t\t<ConnectionConfigContext.Provider\n\t\t\t\t\t\tvalue={{\n\t\t\t\t\t\t\tmcpUrl: data.mcpUrl || \"\",\n\t\t\t\t\t\t\tapiKey: token,\n\t\t\t\t\t\t\tnamespace: data.namespace,\n\t\t\t\t\t\t\tconnectionId: connectionId,\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div className=\"flex-1 overflow-hidden\">\n\t\t\t\t\t\t\t<ToolsPanel tools={toolsQuery.data} onExecute={handleExecute} />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</ConnectionConfigContext.Provider>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n\nexport const Connections = ({\n\ttoken,\n\tnamespace,\n}: {\n\ttoken: string;\n\tnamespace?: string;\n}) => {\n\tconst [activeConnectionId, setActiveConnectionId] = useState<string | null>(\n\t\tnull,\n\t);\n\n\treturn (\n\t\t<div className=\"w-full h-full flex\">\n\t\t\t<div className=\"w-full max-w-sm border-r-3 h-full overflow-auto\">\n\t\t\t\t<ConnectionsList\n\t\t\t\t\ttoken={token}\n\t\t\t\t\tnamespace={namespace}\n\t\t\t\t\tonActiveConnectionIdChange={setActiveConnectionId}\n\t\t\t\t\tdefaultShowSearchServers={false}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div className=\"w-full flex-1 overflow-auto\">\n\t\t\t\t<ActiveConnection\n\t\t\t\t\ttoken={token}\n\t\t\t\t\tnamespace={namespace}\n\t\t\t\t\tconnectionId={activeConnectionId || \"\"}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n",
      "type": "registry:component",
      "target": "components/smithery/connections.tsx"
    }
  ],
  "type": "registry:block"
}